---
title: "Mortality Data: Overview and Usage"
author: "Ines Gerard-Ursin"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Mortality Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, message=FALSE}
library(peeps)
library(ggplot2)
```


## Data Overview

The dataset that fits the [malariasimulation](https://github.com/mrc-ide/malariasimulation/) package input is mortality_rates, and it is a combination of both the age specific mortality rates and the neonatal mortality rates. The first section will outline how they were combined in addition to the interpolation done to get rates by year, while the subsequent sections will break these building block datasets down into greater detail.

### Loading Wrangled Mortality Rates

[Malariasimulation](https://github.com/mrc-ide/malariasimulation/) takes standard 
demography data as a vector taken from a table that looks like this:

| Year | Age From | Age To  |Death Rate|
|------|----------|---------|----------|
| 2010 | 0        | .083333 | .4014834 |
| 2010 | .0833333 | 1       | .0583379 |
| 2010 | 1        | 5       | .0380348 |
| 2010 | 5        | 10      | .0395061 |
| 2010 | 10       | 15      | .0347255 |
| 2010 | 15       | 20      | .0240849 |
| 2010 | 20       | 25      | .0300902 |
| 2010 | 25       | 30      | .0357914 |
| 2010 | 30       | 35      | .0443123 |
| 2010 | 35       | 40      | .0604932 |
| 2010 | 40       | 45      | .0466799 |
| 2010 | 45       | 50      | .0426199 |
| 2010 | 50       | 55      | .0268332 |
| 2010 | 55       | 60      | .049361  |
| 2010 | 60       | 65      | .0234852 |
| 2010 | 65       | 70      | .0988317 |
| 2010 | 70       | 75      | .046755  |
| 2010 | 75       | 80      | .1638875 |
| 2010 | 80       | 85      | .1148753 |
| 2010 | 85       | 90      | .3409079 |
| 2010 | 90       | 95      | .2239224 |
| 2010 | 95       | 200     | .8338688 |

Data from the [United Nations 2019 World Population Prospects](https://population.un.org/wpp/) (UNWPP) was processed into a downloadable format by the [Vaccine Impact Modelling Consortium](https://www.vaccineimpact.org) (VIMC) at Imperial College London. 
In order to create an easily loadable dataset that is of the same format as that in `malariasimulation`, these data sets were wrangled and combined through the following steps into `peeps::mortality_rates`:

1. Processing the ASMR dataset
    + Grouping the data by age group, country
    + Expanding the 5 year bands to all the years in between
    + Assigning the mortality rates to the first year of the 5 year band
2. Linearly interpolating between the years to get year-specific rates
3. Merging the interpolated ASMR dataset with the NMR data

The dataset can either be loaded directly using `peeps::mortality_rates` or loaded using the helper function `load_deathrates`:

```{r load deathrates, fig.width=7}
# load all death rates
all_mortality_rates <- peeps::load_deathrates()

head(all_mortality_rates)

ggplot(data = all_mortality_rates, aes(x = factor(age_upper), y = mortality_rate)) +
  geom_boxplot() +
  ylab("Mortality rate (per year)") + 
  xlab("Upper age (years)") +
  theme_bw()

# load data by country, year
deathrates_ghana <- peeps::load_deathrates(iso3c = "GHA", year = 2020)
head(deathrates_ghana)
```


### Population Mortality

Data Set | Mortality Rate | Definition | Equation
------------- | ------------- | ------------- | -------------
asmr | Age specific mortality rate. | Measures incidence of death at each age, adjusted for population distributions. Assumes age-mortality profile of the cohort stays constant throughout life. Number of deaths every year at age x ($d_{x}$) divided by the mid year population of age x ($p_{x}$). | $m_{x} = \frac{d_{x}}{p_{x}}$

The population level mortality rates provided by this package are taken from the model life tables calculated in the [United Nations 2019 World Population Prospects](https://population.un.org/wpp/) (UNWPP). More details on the model life tables and how they are calculated can be found [here](https://www.un.org/development/desa/pd/data/model-life-tables), and details on the UNWPP 2019 methodology can be found [here](https://population.un.org/wpp/Publications/Files/WPP2019_Methodology.pdf). These data are processed into a downloadable format by the [Vaccine Impact Modelling Consortium](https://www.vaccineimpact.org) (VIMC) at Imperial College London.


There are two standard measures of mortality: the age specific mortality rate (ASMR, also known as $m_{x}$, or the central rate of mortality) and the crude death rate (CDR), which is calculated using the total number of deaths at a certain age and the life table projections of person years lived. Given the variability in crude death numbers by year, cohort, random error/outliers/biases in reporting and measurement, and the underlying age distribution in a population, the ASMR is often used in order to compare mortality trends across times and countries. The ASMR takes an average over 5 year timespans and 5 year age groups, and adjusts for higher age distributions in populations. However, the ASMR is taken from a model life table, which is a theoretical tool used to model the mortality profile of a specific cohort over time, and thus assumes that this mortality profile remains constant throughout the life of the cohort. Therefore, the CDR can be helpful in providing a snapshot of a country's specific population profile at a given moment in time, and allows for the year over year variation in the differences in mortality by cohort.

### Child Mortality Data

Data Set | Mortality Rate | Definition | Source
------------- | ------------- | ------------- | -------------
nmr | Neonatal mortality rate. | Probability of dying between birth and exact age 28 days. It is expressed as average annual deaths per 1,000 births. | VIMC (Combination of UNWPP and [IGME](https://childmortality.org/))


The UNWPP provides smoothed estimates of the IMR and the U5MR, however does not provide estimates of the NMR. The [UN Inter-agency Group for Child Mortality Estimation](https://childmortality.org/) provides much more detailed estimates of all past child mortality rates, including NMR, through a process of detailed data collection and careful model fitting, however does not provide any projections of the NMR into the future. The VIMC has therefore proposed an NMR estimate that is a scaled transformation of the UNWPP's IMR, multiplied by the fraction of NMR/IMR from the IGME. This calculation is justified by the fact that the NMR is a fraction of the IMR, and an assumption that this means that this relationship remains consistent over time. For estimates before or after the IGME time range, the closest data points are used. 
